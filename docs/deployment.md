# Деплой на Бегет

Этот документ описывает процесс автоматического деплоя темы на хостинг Бегет через GitHub Actions.

## Как это работает?

При каждом пуше в ветку `main` на GitHub, автоматически запускается процесс деплоя:

1. GitHub Actions проверяет код
2. Подключается к FTP серверу Бегет
3. Загружает файлы темы на сервер
4. Тема обновляется на сайте

## Настройка деплоя

### Шаг 1: Настройка секретов в GitHub

1. Перейди в настройки репозитория на GitHub
2. Выбери **Settings → Secrets and variables → Actions**
3. Нажми **New repository secret**
4. Добавь следующие секреты:

   - **BEGET_FTP_HOST**
     - Значение: адрес FTP сервера (например, `ftp.yourdomain.com` или IP адрес)
     - Где найти: в панели управления Бегет, раздел FTP

   - **BEGET_FTP_USER**
     - Значение: логин FTP (например, `gociss`)
     - Где найти: в панели управления Бегет, раздел FTP

   - **BEGET_FTP_PASSWORD**
     - Значение: пароль FTP
     - Где найти: в панели управления Бегет, раздел FTP

### Шаг 2: Проверка пути на сервере

Убедись, что путь к теме на сервере правильный. По умолчанию используется:
```
/wp-content/themes/gociss-theme/
```

Если путь другой, отредактируй файл `.github/workflows/deploy.yml` и измени значение `server-dir`.

## Процесс деплоя

### Автоматический деплой

1. Внеси изменения в код темы
2. Закоммить изменения:
   ```bash
   git add .
   git commit -m "Описание изменений"
   ```
3. Запушь в репозиторий:
   ```bash
   git push origin main
   ```
4. GitHub Actions автоматически запустит деплой
5. Проверь статус в разделе **Actions** на GitHub

### Ручной запуск деплоя

Если нужно запустить деплой вручную:

1. Перейди в раздел **Actions** на GitHub
2. Выбери workflow "Deploy to Beget"
3. Нажми **Run workflow**
4. Выбери ветку `main`
5. Нажми **Run workflow**

## Мониторинг деплоя

### Просмотр логов

1. Перейди в **Actions** на GitHub
2. Выбери последний запуск workflow
3. Открой задачу "Deploy theme to Beget"
4. Просмотри логи выполнения

### Типичные проблемы

**Ошибка подключения к FTP:**
- Проверь правильность данных в секретах
- Убедись, что FTP доступен с внешних IP

**Ошибка пути:**
- Проверь, что путь `server-dir` правильный
- Убедись, что папка темы существует на сервере

**Ошибка прав доступа:**
- Проверь права доступа к папке темы на сервере (должны быть 755)

## Что деплоится?

Деплоятся только файлы темы из папки `wp-content/themes/gociss-theme/`.

**НЕ деплоятся:**
- Файлы WordPress (wp-config.php, wp-content/uploads и т.д.)
- node_modules
- Файлы Git (.git, .gitignore)
- Временные файлы

Список исключений находится в файле `.gitignore`.

## Безопасность

### Защита секретов

- Никогда не коммить FTP пароли в код
- Используй только GitHub Secrets для хранения паролей
- Регулярно меняй пароли FTP

### Резервное копирование

Перед деплоем рекомендуется:
1. Сделать бэкап базы данных WordPress
2. Скачать текущую версию темы с сервера
3. Протестировать изменения локально

## Откат изменений

Если что-то пошло не так:

1. Найди последний рабочий коммит в истории Git
2. Откатись к нему:
   ```bash
   git checkout <hash-коммита>
   git push origin main --force
   ```
3. Или вручную загрузи старую версию темы через FTP

## Альтернативные методы деплоя

### Через панель Бегет

1. Зайди в панель управления Бегет
2. Открой файловый менеджер
3. Загрузи файлы темы вручную

### Через FTP клиент

Используй FileZilla или другой FTP клиент для ручной загрузки файлов.

## Полезные команды

```bash
# Проверка статуса Git
git status

# Просмотр последних коммитов
git log --oneline -10

# Откат последнего коммита (локально)
git reset --soft HEAD~1

# Просмотр изменений перед коммитом
git diff
```

## Часто задаваемые вопросы

**Q: Сколько времени занимает деплой?**
A: Обычно 1-3 минуты, зависит от размера файлов и скорости интернета.

**Q: Сайт будет недоступен во время деплоя?**
A: Нет, WordPress продолжит работать. Изменения применятся после завершения загрузки.

**Q: Можно ли деплоить только определённые файлы?**
A: Да, можно изменить workflow, чтобы загружать только нужные файлы.

**Q: Как отключить автоматический деплой?**
A: Удали или закомментируй workflow файл `.github/workflows/deploy.yml`.



